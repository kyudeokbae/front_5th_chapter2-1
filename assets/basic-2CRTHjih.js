import"./modulepreload-polyfill-B5Qt9EMX.js";const o={CART:"cart-items",CART_TOTAL_SUMMARY:"cart-total",STOCK_STATUS:"stock-status",PRODUCT_SELECT:"product-select",ADD_TO_CART:"add-to-cart",LOYALTY_POINTS:"loyalty-points"},x=.8,f=.95,A=.1,L=.3,h=10,g=30,M={p1:.1,p2:.15,p3:.2,p4:.05,p5:.25},I=.25,O=3e4,R=1e4,N=6e4,D=2e4,b={TUESDAY:2},q=[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],l={state:{products:[...q],lastSelectedProductId:null,totalAmount:0},actions:{updateProducts:e=>l.state.products=e,updateLastSelectedProductId:e=>l.state.lastSelectedProductId=e,updateTotalAmount:e=>l.state.totalAmount=e}},d=e=>l.state[e]??null,y=(e,...n)=>l.actions[e]&&l.actions[e](...n),r=(e,n={})=>{const t=document.createElement(e);return n.id&&(t.id=n.id),n.className&&(t.className=n.className),n.textContent&&(t.textContent=n.textContent),n.innerHTML&&(t.innerHTML=n.innerHTML),n.children&&n.children.forEach(a=>t.appendChild(a)),n.events&&Object.entries(n.events).forEach(([a,c])=>{t.addEventListener(a,c)}),t},P=()=>{const e=d("totalAmount"),t="(포인트: "+Math.floor(e/1e3)+")";let a=document.getElementById(o.LOYALTY_POINTS);a?a.textContent=t:(a=r("span",{id:o.LOYALTY_POINTS,className:"text-blue-500 ml-2",textContent:t}),document.getElementById(o.CART_TOTAL_SUMMARY).appendChild(a))},U=(e,n)=>n>=h?M[e]??0:0,v=()=>{const n=d("products").filter(t=>t.quantity<5).map(t=>t.name+": "+(t.quantity>0?"재고 부족 ("+t.quantity+"개 남음)":"품절")).join(`
`);document.getElementById(o.STOCK_STATUS).textContent=n},B=(e,n,t)=>{const a=n-t;let c=a/n||0;return e>=g&&n*I>a&&(t=n*(1-I),c=I),new Date().getDay()===b.TUESDAY&&(t*=1-A,c=Math.max(c,A)),{finalTotalAmount:t,discountRate:c}},Y=e=>{const n=r("span",{className:"text-green-500 ml-2",textContent:"("+(e*100).toFixed(1)+"% 할인 적용)"});document.getElementById(o.CART_TOTAL_SUMMARY).appendChild(n)},p=()=>{const e=document.getElementById(o.CART).children;let n=0,t=0,a=0;for(let u=0;u<e.length;u++){const m=d("products").find(_=>_.id===e[u].id),i=parseInt(e[u].querySelector("span").textContent.split("x ")[1]),T=m.price*i;n+=i,t+=T;const E=U(m.id,i);a+=T*(1-E)}const{finalTotalAmount:c,discountRate:s}=B(n,t,a);document.getElementById(o.CART_TOTAL_SUMMARY).textContent="총액: "+Math.round(c)+"원",s>0&&Y(s),y("updateTotalAmount",c),v(),P()},C=()=>{const e=document.getElementById(o.PRODUCT_SELECT);e.innerHTML="",d("products").forEach(t=>{const a=document.createElement("option");a.value=t.id,a.textContent=t.name+" - "+t.price+"원",a.disabled=t.quantity===0,e.appendChild(a)})},w=e=>{setTimeout(()=>{setInterval(()=>{const n=d("products"),t=n[Math.floor(Math.random()*n.length)];Math.random()<L&&t.quantity>0&&(t.price=Math.round(t.price*x),alert("번개세일! "+t.name+"이(가) 20% 할인 중입니다!"),e())},O)},Math.random()*R)},$=e=>{setTimeout(()=>{setInterval(()=>{const n=d("lastSelectedProductId");if(n){const a=d("products").find(c=>c.id!==n&&c.quantity>0);a&&(alert(a.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!"),a.price=Math.round(a.price*f),e())}},N)},Math.random()*D)},H=(e,n)=>{const a=d("products").find(T=>T.id===e),c=document.getElementById(e),s=c.querySelector("span"),[u,S]=s.textContent.split("x "),m=parseInt(S),i=m+n;i>0&&i<=a.quantity+m?(s.textContent=u+"x "+i,a.quantity-=n):i<=0?(c.remove(),a.quantity-=n):alert("재고가 부족합니다."),p()},k=e=>{const t=d("products").find(s=>s.id===e),a=document.getElementById(e),c=parseInt(a.querySelector("span").textContent.split("x ")[1]);t.quantity+=c,a.remove(),p()},Q=e=>{const{target:n}=e,t=n.classList.contains("quantity-change"),a=n.classList.contains("remove-item");if(!t&&!a)return;const c=n.dataset.productId;if(t){const s=parseInt(n.dataset.change);H(c,s)}else a&&k(c)};function F(e,n){const t=e.querySelector("span"),a=parseInt(t.textContent.split("x ")[1]),c=a+1;c<=n.quantity+a?(t.textContent=`${n.name} - ${n.price}원 x ${c}`,n.quantity--):alert("재고가 부족합니다.")}function K(e){const n=document.getElementById(o.CART),t=document.createElement("div");t.id=e.id,t.className="flex justify-between items-center mb-2",t.innerHTML=`
    <span>${e.name} - ${e.price}원 x 1</span>
    <div>
      <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
              data-product-id="${e.id}" data-change="-1">-</button>
      <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
              data-product-id="${e.id}" data-change="1">+</button>
      <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" 
              data-product-id="${e.id}">삭제</button>
    </div>
  `,n.appendChild(t),e.quantity--}const j=()=>{const e=document.getElementById(o.PRODUCT_SELECT).value,t=d("products").find(c=>c.id===e);if(!t||t.quantity<=0)return;const a=document.getElementById(t.id);a?F(a,t):K(t),p(),y("updateLastSelectedProductId",e)},V=()=>r("h1",{className:"text-2xl font-bold mb-4",textContent:"장바구니"}),X=()=>r("div",{id:o.CART,events:{click:Q}}),z=()=>r("div",{id:o.CART_TOTAL_SUMMARY,className:"text-xl font-bold my-4"}),G=()=>r("div",{id:o.STOCK_STATUS,className:"text-sm text-gray-500 mt-2"}),J=()=>r("select",{id:o.PRODUCT_SELECT,className:"border rounded p-2 mr-2"}),Z=()=>r("button",{id:o.ADD_TO_CART,className:"bg-blue-500 text-white px-4 py-2 rounded",textContent:"추가",events:{click:j}}),W={$cartHeader:V(),$cart:X(),$cartTotalSummary:z(),$stockStatus:G(),$productSelect:J(),$addToCartButton:Z()},tt=()=>r("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8",children:Object.values(W)}),et=()=>r("div",{className:"bg-gray-100 p-8",children:[tt()]}),nt=()=>{document.getElementById("app").appendChild(et())},at=()=>{nt(),C(),p(),w(C),$(C)};at();
